<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/0.3.9/peer.min.js"></script>
</head>
<body>
My id: <input id="myid" value="RSomeMyId"><br>
Connect to id: <input id="dstid" value="RSomeMyId"><br>
<button id="conbtn">Connect</button><br>
<button id="callbtn">Call</button><br>

<div>
    <video id="video" width="400" height="300"></video>
</div>

<script>
    const myId = document.getElementById('myid').value;
    const dstId = document.getElementById('dstid').value;
    const conBtn = document.getElementById('conbtn');
    const callBtn = document.getElementById('callbtn');
    const video = document.getElementById('video');

    let peer;

    conBtn.onclick = function () {
        peer = new Peer(myId);

       // navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
        peer.on('call', function(call) {
            console.log('on call');

            call.on('stream', function(remoteStream) {
                console.log('on stream');
                video.src = window.URL.createObjectURL(remoteStream);
                video.play();
            });

            /*
            navigator.getUserMedia({video: true, audio: true}, function(stream) {
                call.answer(stream); // Answer the call with an A/V stream.

            }, function(err) {
                console.log('Failed to get local stream', err);
            });
            */
        });
    };

    callBtn.onclick = function () {
        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
        navigator.getUserMedia({video: true, audio: true}, function(stream) {
            console.log("getUserMedia, got stream");
            var call = peer.call(dstId, stream);
            call.on('stream', function(remoteStream) {
                console.log('on stream 2');
                video.src = window.URL.createObjectURL(remoteStream);
                video.play();
            });
        }, function(err) {
            console.log('Failed to get local stream', err);
        });
    };
</script>
</body>
</html>
